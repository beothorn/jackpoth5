<html>
<body>
	
	<canvas id="game-canvas" width="1024" height="720" style="border:1px solid #d3d3d3;">
	Your browser does not support the HTML5 canvas tag.</canvas>

	<script>
	
		var ballWidth = 23;
		var ballHeight = 26;
		var radius = 9;
		var diameter = 2 * radius;
		var diameterPowerOfTwo = diameter * diameter;
		var speed = 1;

		function areColliding(point1, point2){
		     
		    var xs = point2.x - point1.x;
		    xs = xs * xs;
		     
		    var ys = point2.y - point1.y;
		    ys = ys * ys;

		    return  xs + ys  < diameterPowerOfTwo;
		}

		function onCollision(a, b){
			var normal = {x:a.x-b.x,y:a.y-b.y}; 
			
			var length = Math.sqrt(normal.x * normal.x + normal.y * normal.y);
			if (length === 0) {
		        normal.x = 1;
		        normal.y = 0;
		    } else {
		        normal.x /= length;
		        normal.y /= length;
		    }
			
			//2 corpos nao ocupam o mesmo lugar no espaco.
			a.x += (diameter * normal.x);
			a.y += (diameter * normal.y);
		
			//conservacao de energia
			var aF = a.xSpeed * normal.x + a.ySpeed * normal.y;
			var bF = b.xSpeed * normal.x + b.ySpeed * normal.y;
			
			var fDelta = aF - bF;
			a.xSpeed -=  fDelta * normal.x;
			a.ySpeed -=  fDelta * normal.y;
			
			b.xSpeed +=  fDelta * normal.x;
			b.ySpeed +=  fDelta * normal.y;
		}

		var image = new Image();
		image.src = "images/single-ball.png";
		var canvas= document.getElementById("game-canvas");
		var context= canvas.getContext("2d");
		
		
		var m_canvas = document.createElement('canvas');
		m_canvas.width = ballWidth;
		m_canvas.height = ballHeight;
		var m_context = m_canvas.getContext('2d');
		m_context.drawImage(image, 0, 0);
		
		var elements = new Array();
		for(var i = 0; i < 100; i++){
			elements.push(
				{
					x: Math.random()*canvas.width,
					y: Math.random()*canvas.height,
					xSpeed:speed,
					ySpeed:speed
				}
			);
		}
		
		function loop(){			
			for(var i in elements){
				context.clearRect(elements[i].x-1, elements[i].y-1, m_canvas.width+2, m_canvas.height+2);
			}

			for(var i in elements){
				elements[i].x+=elements[i].xSpeed;
				elements[i].y+=elements[i].ySpeed;
				
				if(elements[i].x > canvas.width)
					elements[i].xSpeed = -speed;
				if(elements[i].x < 0)
					elements[i].xSpeed = speed;
				if(elements[i].y > canvas.height)
					elements[i].ySpeed = -speed;
				if(elements[i].y < 0)
					elements[i].ySpeed = speed;
			
				
			}

			for(var i in elements){
				for(var j in elements){
					if(elements[i] != elements[j] && areColliding(elements[i],elements[j])){
						onCollision(elements[i],elements[j]);
					}
				}
			}

			for(var i in elements){
				context.drawImage(m_canvas, elements[i].x, elements[i].y);
			}
			requestAnimationFrame(loop);			
		}

		loop();
	</script>
</body>
</html>
