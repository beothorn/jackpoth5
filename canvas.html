<html>
<body>
	
	<canvas id="game-canvas" width="1024" height="720" style="border:1px solid #d3d3d3;">
	Your browser does not support the HTML5 canvas tag.</canvas>

	<script>
	
		var ballWidth = 23;
		var ballHeight = 26;
		var radius = 9;
		var diameter = 2 * radius;
		var diameterPowerOfTwo = diameter * diameter;

		var speed = 1;

		function collide(point1, point2){
		     
		    var xs = point2.x - point1.x;
		    xs = xs * xs;
		     
		    var ys = point2.y - point1.y;
		    ys = ys * ys;

		    return  xs + ys  < diameterPowerOfTwo;
		}

		var image = new Image();
		image.src = "images/single-ball.png";
		var canvas= document.getElementById("game-canvas");
		var context= canvas.getContext("2d");
		
		
		var m_canvas = document.createElement('canvas');
		m_canvas.width = ballWidth;
		m_canvas.height = ballHeight;
		var m_context = m_canvas.getContext('2d');
		m_context.drawImage(image, 0, 0);
		
		var elements = new Array();
		for(var i = 0; i < 300; i++){
			elements.push(
				{
					x: Math.random()*canvas.width,
					y: Math.random()*canvas.height,
					xSpeed:speed,
					ySpeed:speed
				}
			);
		}
	
		var toBeRemoved = new Array();	
		function loop(){			
			for(var i in elements){
				context.clearRect(elements[i].x, elements[i].y, m_canvas.width, m_canvas.height);
			}

			for(var i in elements){
				elements[i].x+=elements[i].xSpeed;
				elements[i].y+=elements[i].ySpeed;
				
				if(elements[i].x > canvas.width)
					elements[i].xSpeed = -speed;
				if(elements[i].x < 0)
					elements[i].xSpeed = speed;
				if(elements[i].y > canvas.height)
					elements[i].ySpeed = -speed;
				if(elements[i].y < 0)
					elements[i].ySpeed = speed;
			
				
			}

			for(var i in elements){
				for(var j in elements){
					if(!toBeRemoved) toBeRemoved = new Array();
					if(elements[i] != elements[j] && collide(elements[i],elements[j])){
						toBeRemoved.push(elements[i]);
						toBeRemoved.push(elements[j]);
					}
				}
			}

			if(toBeRemoved){
				for(var i in toBeRemoved){
					var index = elements.indexOf(toBeRemoved[i]);
					if (index > -1) {
						elements.splice(index, 1);
					}
				}
			}
			toBeRemoved = null;

			for(var i in elements){
				context.drawImage(m_canvas, elements[i].x, elements[i].y);
			}
			requestAnimationFrame(loop);			
		}

		loop();
	</script>
</body>
</html>
